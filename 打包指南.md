# 📦 桌面应用打包指南

## 🎯 两种使用方式

### 方式一：开发模式（快速测试）

**直接运行桌面版，无需打包：**

双击 `运行桌面版.bat`

这会：
1. 自动安装依赖（首次）
2. 构建 Next.js 应用
3. 启动 Electron 桌面窗口

**优点**：快速启动，适合开发测试  
**缺点**：需要 Node.js 环境

---

### 方式二：生产打包（分发软件）

**打包成独立的 .exe 安装程序：**

双击 `打包成软件.bat`

这会：
1. 安装所有依赖
2. 构建生产版本
3. 使用 Electron Builder 打包
4. 生成安装程序

**输出文件：**
```
dist/
└── 学术主页生成器 Setup.exe  ← 安装程序（约 200-300MB）
```

**优点**：
- ✅ 真正的独立软件
- ✅ 无需 Node.js 环境
- ✅ 可直接分享给他人
- ✅ 一键安装到系统

---

## 🚀 打包步骤详解

### 1. 确保环境准备

**必需：**
- Node.js 18+ (https://nodejs.org/)
- npm 包管理器

**验证安装：**
```bash
node -v   # 应显示 v18.x.x 或更高
npm -v    # 应显示版本号
```

### 2. 安装依赖

如果还没安装，运行：
```bash
npm install
```

新增的依赖：
- `electron` - 桌面应用框架
- `electron-builder` - 打包工具
- `concurrently` - 并发运行工具
- `wait-on` - 等待服务器启动

### 3. 开始打包

**方法 A：使用脚本（推荐）**
```bash
双击 打包成软件.bat
```

**方法 B：手动命令**
```bash
npm run build     # 构建 Next.js
npm run dist      # 打包 Electron
```

### 4. 等待完成

打包过程需要 **5-10 分钟**，取决于：
- 网络速度（下载 Electron 二进制文件）
- CPU 性能（构建和压缩）

**进度显示：**
```
[1/4] 安装依赖...        ✓
[2/4] 构建 Next.js...    ✓
[3/4] 打包 Electron...   ✓
[4/4] 完成！             ✓
```

### 5. 找到安装程序

打包完成后，查看：
```
d:\project\dist\学术主页生成器 Setup.exe
```

---

## 📦 安装程序说明

### 文件大小
- **安装程序**: ~200-300 MB
- **安装后**: ~400-500 MB

（包含 Node.js runtime、Next.js、所有依赖）

### 安装选项
- ✅ 选择安装位置
- ✅ 创建桌面快捷方式
- ✅ 添加到开始菜单

### 卸载
通过 Windows「设置 → 应用」卸载

---

## 🎨 自定义图标（可选）

### 1. 准备图标文件

创建 `build/icon.ico` 文件：
- 格式：`.ico`
- 尺寸：256x256 或 512x512
- 内容：你的应用 Logo

### 2. 在线制作图标

推荐工具：
- https://www.icoconverter.com/
- https://convertio.co/zh/png-ico/

上传 PNG，导出为 ICO 格式

### 3. 放置图标

```
d:\project/
└── build/
    └── icon.ico  ← 放这里
```

### 4. 重新打包

运行 `打包成软件.bat` 即可

---

## 🛠️ 高级配置

### 修改应用名称

编辑 `package.json`：
```json
{
  "build": {
    "productName": "你的应用名称",
    "appId": "com.yourname.app"
  }
}
```

### 修改窗口大小

编辑 `electron/main.js`：
```javascript
const mainWindow = new BrowserWindow({
  width: 1400,  // ← 修改宽度
  height: 900,  // ← 修改高度
  ...
});
```

### 启用开发者工具

编辑 `electron/main.js`，取消注释：
```javascript
mainWindow.webContents.openDevTools();
```

---

## 🔧 故障排查

### 问题 1: 打包失败 - "electron-builder not found"

**解决：**
```bash
npm install electron-builder --save-dev
```

### 问题 2: 打包失败 - 网络错误

**解决：**
设置淘宝镜像
```bash
npm config set electron_mirror https://npmmirror.com/mirrors/electron/
npm run dist
```

### 问题 3: 安装后打不开

**可能原因：**
- 杀毒软件拦截
- 端口 3000 被占用

**解决：**
1. 添加到杀毒软件白名单
2. 修改 `electron/main.js` 中的端口号

### 问题 4: 窗口空白

**解决：**
等待 3-5 秒，Next.js 服务器需要启动时间

---

## 📊 打包文件结构

```
dist/
├── win-unpacked/                    # 未打包的文件
│   ├── 学术主页生成器.exe          # 可执行文件
│   ├── resources/                   # 资源文件
│   │   └── app.asar                # 应用代码包
│   └── ...
└── 学术主页生成器 Setup.exe       # 安装程序（分发用）
```

---

## 🚀 分发给他人

### 方式一：分享安装程序

1. 找到 `dist\学术主页生成器 Setup.exe`
2. 上传到网盘或直接发送
3. 对方下载后双击安装即可

**优点**：正规软件，系统集成  
**缺点**：文件较大（200-300MB）

### 方式二：分享便携版

1. 找到 `dist\win-unpacked` 文件夹
2. 压缩整个文件夹
3. 对方解压后运行 `学术主页生成器.exe`

**优点**：无需安装，绿色便携  
**缺点**：文件夹较大（400-500MB）

---

## ✅ 打包检查清单

打包前检查：
- [ ] Node.js 已安装（v18+）
- [ ] 依赖已安装（`node_modules` 存在）
- [ ] Next.js 构建成功（`.next` 存在）
- [ ] 图标文件已准备（可选）
- [ ] 应用名称已修改（可选）

打包后测试：
- [ ] 双击安装程序能正常安装
- [ ] 安装后能正常启动
- [ ] 上传简历功能正常
- [ ] AI 解析功能正常
- [ ] 生成的网站正常显示

---

## 💡 最佳实践

### 开发阶段
使用 `运行桌面版.bat` 快速测试

### 发布阶段
使用 `打包成软件.bat` 生成安装程序

### 版本管理
每次打包前更新 `package.json` 中的版本号：
```json
{
  "version": "2.0.1"
}
```

---

## 📞 技术支持

遇到问题？
1. 查看 `打包成软件.bat` 的输出日志
2. 检查 `dist` 文件夹是否生成
3. 尝试删除 `node_modules` 和 `.next` 后重新打包

---

**祝打包顺利！🎉**
